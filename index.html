<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Boo Bills">
  <title>Boo Bills</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

    :root {
      --bg: #FAF7F2;
      --card: #FFFFFF;
      --text: #1A1A1A;
      --text-soft: #7A7067;
      --accent: #D4603A;
      --accent-soft: #F2DDD4;
      --green: #3A8A5C;
      --green-soft: #D4EDDF;
      --blue: #4A6FA5;
      --blue-soft: #D6E4F5;
      --purple: #7B5EA7;
      --purple-soft: #E8DFF5;
      --border: #EDE8E1;
      --shadow: 0 2px 12px rgba(0,0,0,0.06);
      --shadow-lg: 0 8px 32px rgba(0,0,0,0.10);
      --radius: 16px;
      --radius-sm: 12px;
      --font: 'DM Sans', 'Avenir', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-display: 'Playfair Display', Georgia, serif;
    }

    body {
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 420px;
      min-height: 100vh;
      padding: 24px 20px;
      padding-top: max(24px, env(safe-area-inset-top, 24px));
      padding-bottom: max(24px, env(safe-area-inset-bottom, 24px));
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* Background decoration */
    .bg-decor {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none; z-index: 0;
    }
    .bg-decor::before {
      content: ''; position: absolute; top: -120px; right: -80px;
      width: 300px; height: 300px; border-radius: 50%;
      background: radial-gradient(circle, rgba(212,96,58,0.08) 0%, transparent 70%);
    }
    .bg-decor::after {
      content: ''; position: absolute; bottom: -80px; left: -60px;
      width: 250px; height: 250px; border-radius: 50%;
      background: radial-gradient(circle, rgba(58,138,92,0.06) 0%, transparent 70%);
    }

    /* Header */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 28px; position: relative; z-index: 1;
    }
    .header-left { display: flex; align-items: center; gap: 12px; }
    .header h1 {
      font-family: var(--font-display); font-size: 28px;
      font-weight: 700; letter-spacing: -0.02em; line-height: 1.2;
    }
    .header h1.small { font-size: 22px; }

    /* Buttons */
    .btn-icon {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 10px; width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; color: var(--text); box-shadow: var(--shadow);
      transition: all 0.15s ease;
    }
    .btn-icon:active { transform: scale(0.95); }
    .btn-icon.muted { color: var(--text-soft); }

    .btn-primary {
      background: var(--accent); color: white; border: none;
      border-radius: var(--radius-sm); padding: 18px;
      font-size: 16px; font-weight: 600; cursor: pointer;
      font-family: var(--font); width: 100%;
      transition: all 0.15s ease;
    }
    .btn-primary:active { transform: scale(0.98); }
    .btn-primary:disabled { opacity: 0.7; cursor: wait; }
    .btn-primary.green { background: var(--green); }
    .btn-primary.blue { background: var(--blue); }
    .btn-primary.purple { background: var(--purple); }

    .btn-secondary {
      display: flex; align-items: center; justify-content: center; gap: 6px;
      background: var(--card); color: var(--text);
      border: 1.5px solid var(--border); border-radius: var(--radius-sm);
      padding: 16px 20px; font-size: 14px; font-weight: 600;
      cursor: pointer; font-family: var(--font); text-decoration: none;
      transition: all 0.15s ease;
    }
    .btn-secondary:active { transform: scale(0.98); }

    /* Expense cards */
    .expense-card {
      display: flex; align-items: center; gap: 16px;
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 18px 20px;
      cursor: pointer; width: 100%; text-align: left;
      box-shadow: var(--shadow); transition: all 0.2s ease;
      position: relative; overflow: hidden;
    }
    .expense-card:active { transform: scale(0.98); }
    @media (hover: hover) {
      .expense-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
    }
    .expense-card .icon-box {
      width: 48px; height: 48px; border-radius: 14px;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .expense-card .card-title { font-size: 16px; font-weight: 600; margin-bottom: 2px; letter-spacing: -0.01em; }
    .expense-card .card-sub { font-size: 13px; color: var(--text-soft); line-height: 1.3; }
    .expense-card .chevron { color: var(--text-soft); opacity: 0.4; flex-shrink: 0; }

    /* Split options */
    .split-option {
      display: flex; align-items: center; gap: 14px;
      background: var(--card); border: 1.5px solid var(--border);
      border-radius: var(--radius-sm); padding: 16px 18px;
      cursor: pointer; width: 100%; text-align: left;
      transition: all 0.2s ease;
    }
    .split-option:active { transform: scale(0.98); }
    .split-option .radio {
      width: 22px; height: 22px; border-radius: 50%;
      border: 2px solid var(--border); flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s ease;
    }
    .split-option .opt-title { font-size: 15px; font-weight: 600; }
    .split-option .opt-sub { font-size: 12px; color: var(--text-soft); margin-top: 1px; }

    /* Costco shortcut */
    .costco-card {
      display: flex; align-items: center; gap: 14px;
      background: linear-gradient(135deg, var(--blue), #5A82B8);
      border: none; border-radius: var(--radius); padding: 18px 20px;
      cursor: pointer; width: 100%; text-align: left;
      box-shadow: 0 4px 16px rgba(74,111,165,0.25);
      transition: all 0.2s ease; color: white;
    }
    .costco-card:active { transform: scale(0.98); }
    @media (hover: hover) {
      .costco-card:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(74,111,165,0.35); }
    }
    .costco-card .icon-box {
      width: 44px; height: 44px; border-radius: 12px;
      background: rgba(255,255,255,0.2); display: flex;
      align-items: center; justify-content: center; flex-shrink: 0;
    }
    .costco-card .card-title { font-size: 16px; font-weight: 600; margin-bottom: 2px; }
    .costco-card .card-sub { font-size: 12px; opacity: 0.85; }

    /* Amount input */
    .amount-area { text-align: center; }
    .amount-label {
      font-size: 13px; font-weight: 600; color: var(--text-soft);
      text-transform: uppercase; letter-spacing: 0.08em;
    }
    .amount-wrap { position: relative; margin-top: 12px; display: inline-block; }
    .dollar-sign {
      position: absolute; left: -28px; top: 50%; transform: translateY(-50%);
      font-size: 42px; font-weight: 300; color: var(--text-soft); opacity: 0.5;
      font-family: var(--font-display);
    }
    .amount-input {
      width: 200px; text-align: center; font-size: 48px; font-weight: 300;
      font-family: var(--font-display); border: none;
      border-bottom: 2px solid var(--border); background: transparent;
      outline: none; padding: 8px 0; color: var(--text);
      transition: border-color 0.2s;
    }
    .amount-input:focus { border-bottom-color: var(--accent); }
    .amount-input.green:focus { border-bottom-color: var(--green); }
    .amount-input.blue:focus { border-bottom-color: var(--blue); }
    .amount-input.purple:focus { border-bottom-color: var(--purple); }

    .desc-input {
      width: 100%; max-width: 280px; text-align: center;
      padding: 12px 16px; font-size: 15px;
      border: 1.5px solid var(--border); border-radius: var(--radius-sm);
      background: var(--card); font-family: var(--font);
      outline: none; transition: border-color 0.2s;
    }
    .desc-input:focus { border-color: var(--accent); }
    .desc-input.green:focus { border-color: var(--green); }
    .desc-input.blue:focus { border-color: var(--blue); }
    .desc-input.purple:focus { border-color: var(--purple); }

    /* Preview box */
    .preview-split {
      display: flex; justify-content: center; gap: 24px; padding: 12px 0;
      animation: fadeIn 0.3s ease;
    }
    .preview-split .person { text-align: center; }
    .preview-split .label { font-size: 12px; color: var(--text-soft); margin-bottom: 2px; }
    .preview-split .value { font-size: 17px; font-weight: 600; }
    .preview-split .divider { width: 1px; background: var(--border); }

    .preview-box {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius-sm); padding: 14px 18px;
      max-width: 300px; margin: 0 auto; width: 100%;
      animation: fadeIn 0.3s ease;
    }
    .preview-box .preview-title {
      font-size: 12px; color: var(--text-soft); margin-bottom: 8px;
      font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;
    }
    .preview-box .row {
      display: flex; justify-content: space-between;
      font-size: 13px; margin-bottom: 4px;
    }
    .preview-box .row:last-child { margin-bottom: 0; }
    .preview-box .row .rlabel { color: var(--text-soft); }
    .preview-box .row .rval { font-weight: 600; }

    /* Success screen */
    .success-icon {
      width: 72px; height: 72px; border-radius: 50%;
      background: var(--green-soft); color: var(--green);
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 24px; animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .success-title {
      font-family: var(--font-display); font-size: 24px;
      font-weight: 700; margin-bottom: 8px;
    }
    .success-msg { color: var(--text-soft); font-size: 15px; margin-bottom: 32px; line-height: 1.5; }

    /* Settings */
    .settings-label {
      font-size: 13px; font-weight: 600; color: var(--text-soft);
      text-transform: uppercase; letter-spacing: 0.05em;
      margin-bottom: 8px; display: block;
    }
    .settings-input {
      width: 100%; padding: 14px 16px; font-size: 14px;
      border: 1.5px solid var(--border); border-radius: var(--radius-sm);
      background: var(--card); font-family: var(--font);
      outline: none; transition: border-color 0.2s;
    }
    .settings-input:focus { border-color: var(--accent); }
    .settings-hint { font-size: 12px; color: var(--text-soft); margin-top: 6px; line-height: 1.4; }

    .setup-box {
      background: var(--blue-soft); border-radius: var(--radius-sm);
      padding: 16px; margin-top: 8px;
    }
    .setup-box .setup-title { font-size: 13px; font-weight: 600; color: var(--blue); margin-bottom: 8px; }
    .setup-box ol { font-size: 12px; color: var(--blue); margin: 0; padding-left: 16px; line-height: 1.6; }

    .warning-box {
      background: #FFF3E0; border-radius: var(--radius-sm);
      padding: 14px 16px; margin-bottom: 20px;
      display: flex; align-items: center; gap: 10px;
      border: 1px solid #FFE0B2;
    }
    .warning-box p { font-size: 13px; color: #E65100; line-height: 1.4; }

    .error-msg { color: #D44; font-size: 13px; text-align: center; }

    .section-label {
      font-size: 11px; font-weight: 600; color: var(--text-soft);
      text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 10px;
    }

    .sheet-link {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      color: var(--text-soft); font-size: 13px; font-weight: 500;
      text-decoration: none; padding: 12px;
      border-radius: var(--radius-sm); transition: all 0.2s;
      border: 1px solid var(--border); background: var(--card);
    }

    .spacer { flex: 1; }
    .gap-10 { display: flex; flex-direction: column; gap: 10px; }
    .gap-20 { display: flex; flex-direction: column; gap: 20px; }
    .mb-20 { margin-bottom: 20px; }
    .mb-24 { margin-bottom: 24px; }
    .mt-8 { margin-top: 8px; }
    .center { text-align: center; }
    .vcenter { display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1; }

    .screen { display: none; flex-direction: column; flex: 1; position: relative; z-index: 1; }
    .screen.active { display: flex; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    /* Hide number input spinners */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
  </style>
</head>
<body>
  <div class="bg-decor"></div>
  <div class="app" id="app">

    <!-- ═══ HOME SCREEN ═══ -->
    <div class="screen active" id="screen-home">
      <div class="header">
        <div class="header-left">
          <h1>Boo Bills</h1>
        </div>
        <button class="btn-icon muted" onclick="showScreen('settings')" aria-label="Settings">
          <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.32 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        </button>
      </div>
      <div id="home-warning"></div>
      <div class="gap-10 mb-24">
        <button class="expense-card" onclick="showScreen('boobills')">
          <div class="icon-box" style="background:var(--accent-soft);color:var(--accent)">
            <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8"><path stroke-linecap="round" stroke-linejoin="round" d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
          </div>
          <div style="flex:1">
            <div class="card-title">Boo Bills</div>
            <div class="card-sub">Joint expense — Connor & Spencer</div>
          </div>
          <div class="chevron"><svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></div>
        </button>
        <button class="expense-card" onclick="startAmount('mom-owed')">
          <div class="icon-box" style="background:var(--green-soft);color:var(--green)">
            <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="9"/><path stroke-linecap="round" d="M9 10h.01M15 10h.01M8 14s1.5 2 4 2 4-2 4-2"/></svg>
          </div>
          <div style="flex:1">
            <div class="card-title">Money Owed to Mom</div>
            <div class="card-sub">Connor owes Mom</div>
          </div>
          <div class="chevron"><svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></div>
        </button>
        <button class="expense-card" onclick="startAmount('mom-owes')">
          <div class="icon-box" style="background:var(--purple-soft);color:var(--purple)">
            <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h11M3 10l4-4M3 10l4 4"/><circle cx="17" cy="10" r="5"/><path stroke-linecap="round" d="M15.5 8.5h.01M18.5 8.5h.01M15 12s.75 1 2 1 2-1 2-1"/></svg>
          </div>
          <div style="flex:1">
            <div class="card-title">Mom Owes Connor</div>
            <div class="card-sub">Mom pays Connor back</div>
          </div>
          <div class="chevron"><svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></div>
        </button>
      </div>
      <div class="mb-20">
        <div class="section-label">Quick Actions</div>
        <button class="costco-card" onclick="startAmount('costco')">
          <div class="icon-box">
            <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-8 2a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/></svg>
          </div>
          <div>
            <div class="card-title">Costco Run</div>
            <div class="card-sub">Logs to Mom + 80/20 Boo Bills</div>
          </div>
        </button>
      </div>
      <div id="home-sheet-link"></div>
    </div>

    <!-- ═══ BOO BILLS SPLIT SCREEN ═══ -->
    <div class="screen" id="screen-boobills">
      <div class="header">
        <div class="header-left">
          <button class="btn-icon" onclick="showScreen('home')">
            <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          </button>
          <h1 class="small">Boo Bills</h1>
        </div>
      </div>
      <p style="color:var(--text-soft);font-size:14px;margin:0 0 20px 0;line-height:1.5">How should this expense be split?</p>
      <div class="gap-10">
        <button class="split-option" onclick="startAmount('boobills','80/20')">
          <div class="radio"></div>
          <div>
            <div class="opt-title">80 / 20 Split</div>
            <div class="opt-sub">Connor 80% · Spencer 20%</div>
          </div>
        </button>
        <button class="split-option" onclick="startAmount('boobills','Connor owes Spencer')">
          <div class="radio"></div>
          <div>
            <div class="opt-title">Connor owes Spencer</div>
            <div class="opt-sub">Connor pays 100%</div>
          </div>
        </button>
        <button class="split-option" onclick="startAmount('boobills','Spencer owes Connor')">
          <div class="radio"></div>
          <div>
            <div class="opt-title">Spencer owes Connor</div>
            <div class="opt-sub">Spencer pays 100%</div>
          </div>
        </button>
      </div>
    </div>

    <!-- ═══ AMOUNT SCREEN ═══ -->
    <div class="screen" id="screen-amount">
      <div class="header">
        <div class="header-left">
          <button class="btn-icon" onclick="goBackFromAmount()">
            <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          </button>
          <h1 class="small" id="amount-title"></h1>
        </div>
      </div>
      <div class="spacer"></div>
      <div class="gap-20 center" style="margin-bottom:32px">
        <div class="amount-area">
          <div class="amount-label">Amount</div>
          <div class="amount-wrap">
            <span class="dollar-sign">$</span>
            <input type="number" inputmode="decimal" id="amount-input" class="amount-input"
                   placeholder="0.00" oninput="updatePreview()" onkeydown="if(event.key==='Enter')submitExpense()">
          </div>
        </div>
        <div class="center">
          <input type="text" id="desc-input" class="desc-input" placeholder="What's this for? (optional)"
                 onkeydown="if(event.key==='Enter')submitExpense()">
        </div>
        <div id="preview-area"></div>
        <div id="error-area"></div>
      </div>
      <div class="spacer"></div>
      <button class="btn-primary" id="submit-btn" onclick="submitExpense()">Log Expense</button>
    </div>

    <!-- ═══ SUCCESS SCREEN ═══ -->
    <div class="screen" id="screen-success">
      <div class="vcenter center">
        <div class="success-icon">
          <svg width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
        </div>
        <div class="success-title">Logged!</div>
        <div class="success-msg" id="success-msg"></div>
        <div style="display:flex;gap:12px;width:100%">
          <button class="btn-primary" onclick="resetApp()" style="flex:1">Done</button>
          <a class="btn-secondary" id="success-sheet-link" href="#" target="_blank" rel="noopener noreferrer" style="display:none">
            Sheet <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3"/></svg>
          </a>
        </div>
      </div>
    </div>

    <!-- ═══ SETTINGS SCREEN ═══ -->
    <div class="screen" id="screen-settings">
      <div class="header">
        <div class="header-left">
          <button class="btn-icon" onclick="showScreen('home')">
            <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          </button>
          <h1 class="small">Settings</h1>
        </div>
      </div>
      <div class="gap-20">
        <div>
          <label class="settings-label">Google Apps Script URL</label>
          <input type="url" id="settings-script-url" class="settings-input" placeholder="https://script.google.com/macros/s/...">
          <p class="settings-hint">Deploy the Apps Script as a web app and paste the URL here. Must end in /exec</p>
        </div>
        <div>
          <label class="settings-label">Google Sheet URL (optional)</label>
          <input type="url" id="settings-sheet-url" class="settings-input" placeholder="https://docs.google.com/spreadsheets/d/...">
          <p class="settings-hint">Link to your Google Sheet for quick access from the app.</p>
        </div>
        <button class="btn-primary" onclick="saveSettings()">Save Settings</button>

        <div class="setup-box mt-8">
          <div class="setup-title">Setup Instructions</div>
          <ol>
            <li>Create a Google Sheet with two tabs: <strong>"Boo Bills"</strong> and <strong>"Mom"</strong></li>
            <li>In Boo Bills, add headers: Date | Description | Amount | Split Type | Connor Owes | Spencer Owes</li>
            <li>In Mom, add headers: Date | Description | Amount | Type</li>
            <li>Go to Extensions → Apps Script</li>
            <li>Paste the backend code (see google-apps-script.js)</li>
            <li>Deploy → New Deployment → Web App → Anyone can access</li>
            <li>Copy the URL (must end in <strong>/exec</strong>) and paste it above</li>
          </ol>
        </div>
      </div>
    </div>

  </div>

  <script>
    // ═══ STATE ═══
    var currentScreen = 'home';
    var expenseType = null;
    var splitType = null;
    var scriptUrl = '';
    var sheetUrl = '';

    // ═══ INIT ═══
    function init() {
      try {
        scriptUrl = localStorage.getItem('boobills_script_url') || '';
        sheetUrl = localStorage.getItem('boobills_sheet_url') || '';
      } catch(e) {}
      updateHomeWarning();
      updateHomeSheetLink();
    }

    // ═══ NAVIGATION ═══
    function showScreen(name) {
      document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
      document.getElementById('screen-' + name).classList.add('active');
      currentScreen = name;

      if (name === 'settings') {
        document.getElementById('settings-script-url').value = scriptUrl;
        document.getElementById('settings-sheet-url').value = sheetUrl;
      }
      if (name === 'home') {
        updateHomeWarning();
        updateHomeSheetLink();
      }
    }

    function startAmount(type, split) {
      expenseType = type;
      splitType = split || null;
      showScreen('amount');

      // Set title
      var titles = {
        'boobills': 'Boo Bills — ' + (split || ''),
        'mom-owed': 'Owed to Mom',
        'mom-owes': 'Mom Owes Connor',
        'costco': 'Costco Expense'
      };
      document.getElementById('amount-title').textContent = titles[type];

      // Set color class
      var colorMap = { 'boobills': '', 'mom-owed': 'green', 'mom-owes': 'purple', 'costco': 'blue' };
      var colorClass = colorMap[type];
      document.getElementById('amount-input').className = 'amount-input' + (colorClass ? ' ' + colorClass : '');
      document.getElementById('desc-input').className = 'desc-input' + (colorClass ? ' ' + colorClass : '');

      // Set button color
      var btn = document.getElementById('submit-btn');
      btn.className = 'btn-primary' + (colorClass ? ' ' + colorClass : '');

      // Clear fields
      document.getElementById('amount-input').value = '';
      document.getElementById('desc-input').value = '';
      document.getElementById('preview-area').innerHTML = '';
      document.getElementById('error-area').innerHTML = '';

      setTimeout(function() { document.getElementById('amount-input').focus(); }, 200);
    }

    function goBackFromAmount() {
      if (expenseType === 'boobills') {
        showScreen('boobills');
      } else {
        showScreen('home');
      }
    }

    function resetApp() {
      expenseType = null;
      splitType = null;
      showScreen('home');
    }

    // ═══ PREVIEW ═══
    function updatePreview() {
      var val = parseFloat(document.getElementById('amount-input').value);
      var area = document.getElementById('preview-area');

      if (!val || val <= 0) { area.innerHTML = ''; return; }

      if (expenseType === 'boobills' && splitType === '80/20') {
        area.innerHTML =
          '<div class="preview-split">' +
            '<div class="person"><div class="label">Connor</div><div class="value">' + fmt(val * 0.8) + '</div></div>' +
            '<div class="divider"></div>' +
            '<div class="person"><div class="label">Spencer</div><div class="value">' + fmt(val * 0.2) + '</div></div>' +
          '</div>';
      } else if (expenseType === 'costco') {
        area.innerHTML =
          '<div class="preview-box">' +
            '<div class="preview-title">This will log:</div>' +
            '<div class="row"><span class="rlabel">Mom owed</span><span class="rval">' + fmt(val) + '</span></div>' +
            '<div class="row"><span class="rlabel">Connor (80%)</span><span class="rval">' + fmt(val * 0.8) + '</span></div>' +
            '<div class="row"><span class="rlabel">Spencer (20%)</span><span class="rval">' + fmt(val * 0.2) + '</span></div>' +
          '</div>';
      } else {
        area.innerHTML = '';
      }
    }

    // ═══ SUBMIT ═══
    function submitExpense() {
      var val = parseFloat(document.getElementById('amount-input').value);
      var desc = document.getElementById('desc-input').value.trim();
      var errorArea = document.getElementById('error-area');

      if (!val || val <= 0) {
        errorArea.innerHTML = '<p class="error-msg">Please enter a valid amount</p>';
        return;
      }
      if (!scriptUrl) {
        errorArea.innerHTML = '<p class="error-msg">Please set your Google Apps Script URL in settings first</p>';
        return;
      }

      var btn = document.getElementById('submit-btn');
      btn.disabled = true;
      btn.textContent = 'Logging...';
      errorArea.innerHTML = '';

      var entries = [];
      var now = new Date().toLocaleDateString('en-US');

      if (expenseType === 'costco') {
        entries.push({
          sheet: 'Mom', date: now, description: desc || 'Costco',
          amount: val, type: 'Owed to Mom'
        });
        entries.push({
          sheet: 'Boo Bills', date: now, description: desc || 'Costco',
          amount: val, splitType: '80/20',
          connorOwes: +(val * 0.8).toFixed(2),
          spencerOwes: +(val * 0.2).toFixed(2)
        });
      } else if (expenseType === 'boobills') {
        var entry = {
          sheet: 'Boo Bills', date: now, description: desc || 'Expense',
          amount: val, splitType: splitType
        };
        if (splitType === '80/20') {
          entry.connorOwes = +(val * 0.8).toFixed(2);
          entry.spencerOwes = +(val * 0.2).toFixed(2);
        } else if (splitType === 'Connor owes Spencer') {
          entry.connorOwes = val; entry.spencerOwes = 0;
        } else {
          entry.connorOwes = 0; entry.spencerOwes = val;
        }
        entries.push(entry);
      } else if (expenseType === 'mom-owed') {
        entries.push({
          sheet: 'Mom', date: now, description: desc || 'Expense',
          amount: val, type: 'Owed to Mom'
        });
      } else if (expenseType === 'mom-owes') {
        entries.push({
          sheet: 'Mom', date: now, description: desc || 'Expense',
          amount: val, type: 'Mom Owes Connor'
        });
      }

      fetch(scriptUrl, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ entries: entries })
      }).then(function() {
        // no-cors means opaque response, assume success
        var msgs = {
          'costco': 'Costco expense of ' + fmt(val) + ' logged to both sheets',
          'boobills': fmt(val) + ' added to Boo Bills (' + splitType + ')',
          'mom-owed': fmt(val) + ' owed to Mom logged',
          'mom-owes': fmt(val) + ' Mom owes Connor logged'
        };
        document.getElementById('success-msg').textContent = msgs[expenseType];

        var sheetLink = document.getElementById('success-sheet-link');
        if (sheetUrl) {
          sheetLink.href = sheetUrl;
          sheetLink.style.display = 'flex';
        } else {
          sheetLink.style.display = 'none';
        }

        showScreen('success');
      }).catch(function(err) {
        errorArea.innerHTML = '<p class="error-msg">Failed to submit. Check your Apps Script URL in settings.</p>';
      }).finally(function() {
        btn.disabled = false;
        btn.textContent = 'Log Expense';
      });
    }

    // ═══ SETTINGS ═══
    function saveSettings() {
      scriptUrl = document.getElementById('settings-script-url').value.trim();
      sheetUrl = document.getElementById('settings-sheet-url').value.trim();
      try {
        localStorage.setItem('boobills_script_url', scriptUrl);
        localStorage.setItem('boobills_sheet_url', sheetUrl);
      } catch(e) {}
      showScreen('home');
    }

    function updateHomeWarning() {
      var el = document.getElementById('home-warning');
      if (!scriptUrl) {
        el.innerHTML =
          '<div class="warning-box">' +
            '<span style="font-size:18px">⚙️</span>' +
            '<p>Tap the settings icon to connect your Google Sheet.</p>' +
          '</div>';
      } else {
        el.innerHTML = '';
      }
    }

    function updateHomeSheetLink() {
      var el = document.getElementById('home-sheet-link');
      if (sheetUrl) {
        el.innerHTML =
          '<a class="sheet-link" href="' + sheetUrl + '" target="_blank" rel="noopener noreferrer">' +
            'View Google Sheet ' +
            '<svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3"/></svg>' +
          '</a>';
      } else {
        el.innerHTML = '';
      }
    }

    // ═══ HELPERS ═══
    function fmt(n) {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(n);
    }

    // ═══ GO ═══
    init();
  </script>
</body>
</html>
